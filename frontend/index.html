// API Configuration (Simulated - assuming a backend structure)
        const API_BASE_URL = 'http://localhost:5000/api';

        // Global variables
        let services = [];
        let employees = [];
        let currentCustomerId = null;
        let currentVehicleId = null;
        let nextBillNumber = '0001';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadServices();
            loadEmployees();
            updateDashboard();
            setDefaultDates();
            getNextBillNumber();

            document.getElementById('billDate').textContent = new Date().toLocaleDateString();

            // Event listeners for New Bill page updates
            document.getElementById('customerName').addEventListener('input', updatePreviewCustomer);
            document.getElementById('mobileNumber').addEventListener('input', updatePreviewCustomer);
            document.getElementById('vehicleNumberDisplay').addEventListener('input', updatePreviewCustomer);
            document.getElementById('vehicleType').addEventListener('change', updatePreviewCustomer);
            document.getElementById('customerForm').addEventListener('change', updatePreview);
            document.getElementById('servicesList').addEventListener('change', updatePreview);
            document.getElementById('employeeForm').addEventListener('submit', handleEmployeeFormSubmit);

            // Set initial page active class
            showPage('dashboard');
        });

        // Utility Functions
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-custom alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            container.appendChild(alert);

            setTimeout(() => {
                // Use Bootstrap's method to correctly dismiss the alert
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }, 5000);
        }

        async function apiCall(endpoint, method = 'GET', data = null, silent = false) {
            try {
                // Simulate delay and success/failure (as we don't have a real backend)
                await new Promise(resolve => setTimeout(resolve, 500));

                // --- START: Mock Data & Logic ---
                let mockData = {};
                let error = null;

                if (endpoint.startsWith('/dashboard')) {
                    mockData = {
                        totalVehicles: 25,
                        totalEarnings: 15500,
                        totalServices: 42,
                        activeEmployees: 5,
                        serviceStats: [
                            { name: "Basic Wash", count: 15, revenue: 4500 },
                            { name: "Full Service", count: 8, revenue: 6400 },
                            { name: "Interior Cleaning", count: 10, revenue: 3000 },
                            { name: "Waxing", count: 5, revenue: 1600 }
                        ],
                        recentActivities: [
                            "Bill #0025 for KA01MN0001 created.",
                            "Employee John Doe clocked in.",
                            "Bill #0024 for TN07R7890 created."
                        ]
                    };
                } else if (endpoint.startsWith('/car/')) {
                    const vehicleNum = endpoint.split('/').pop();
                    if (vehicleNum === 'KA01AB1234') {
                        mockData = {
                            id: 1,
                            vehicle_id: 101,
                            name: 'Ravi Kumar',
                            mobile: '9876543210',
                            vehicle_number: 'KA01AB1234',
                            vehicle_type: 'Car'
                        };
                    } else if (vehicleNum === 'TN07R7890') {
                        mockData = {
                            id: 2,
                            vehicle_id: 102,
                            name: 'Priya Sharma',
                            mobile: '9988776655',
                            vehicle_number: 'TN07R7890',
                            vehicle_type: 'SUV'
                        };
                    } else {
                        mockData = null; // New customer/vehicle
                    }
                } else if (endpoint === '/services') {
                    mockData = [
                        { id: 1, name: 'Basic Exterior Wash', price: 300, type: 'Car' },
                        { id: 2, name: 'Full Service Wash (Interior & Exterior)', price: 800, type: 'Car' },
                        { id: 3, name: 'Premium Waxing', price: 1000, type: 'Car' },
                        { id: 4, name: 'Bike Wash', price: 150, type: 'Bike' },
                        { id: 5, name: 'Engine Bay Cleaning', price: 500, type: 'Other' }
                    ];
                } else if (endpoint === '/employees') {
                    if (method === 'POST' && data) {
                        mockData = { ...data, id: employees.length + 1, status: 'Active' };
                    } else {
                        mockData = [
                            { id: 1, name: 'John Doe', mobile: '8000012345', designation: 'Manager', salary: 35000, joining_date: '2023-01-15', status: 'Active' },
                            { id: 2, name: 'Jane Smith', mobile: '8000054321', designation: 'Washer', salary: 18000, joining_date: '2023-03-20', status: 'Active' },
                            { id: 3, name: 'Mike Ross', mobile: '8000011223', designation: 'Detailer', salary: 25000, joining_date: '2023-06-10', status: 'Active' },
                        ];
                    }
                } else if (endpoint === '/bills') {
                    if (method === 'POST' && data) {
                        nextBillNumber = String(parseInt(nextBillNumber) + 1).padStart(4, '0');
                        mockData = { bill_number: data.bill_number, total_amount: data.total_amount };
                    } else {
                        // Mock Reports Data
                        mockData = [
                            { bill_number: '0025', date: '2025-10-04', vehicle: 'KA01AB1234 (Car)', customer: 'Ravi Kumar', services: 'Full Service Wash, Waxing', amount: 1800, employee: 'John Doe', status: 'Completed' },
                            { bill_number: '0024', date: '2025-10-04', vehicle: 'TN07R7890 (SUV)', customer: 'Priya Sharma', services: 'Basic Exterior Wash', amount: 300, employee: 'Jane Smith', status: 'Completed' },
                            { bill_number: '0023', date: '2025-10-03', vehicle: 'MH12CD4567 (Bike)', customer: 'Rajesh', services: 'Bike Wash', amount: 150, employee: 'Mike Ross', status: 'Completed' },
                        ];
                    }
                } else if (endpoint === '/bill/next_number') {
                    mockData = { next_number: nextBillNumber };
                }

                // Simulate success structure
                const result = { success: true, data: mockData };

                if (error) {
                    throw new Error(error);
                }

                // --- END: Mock Data & Logic ---

                if (!result.success) {
                    throw new Error(result.error?.message || 'API Error');
                }

                return result;
            } catch (error) {
                console.error('API Error:', error);
                if (!silent) {
                    showNotification(error.message, 'danger');
                }
                throw error;
            }
        }

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            // Update active link based on the pageId
            document.querySelector(`[onclick="showPage('${pageId}')"]`).classList.add('active');

            if (pageId === 'dashboard') {
                updateDashboard();
            } else if (pageId === 'newbill') {
                resetBillForm();
                getNextBillNumber();
            } else if (pageId === 'employees') {
                loadEmployees();
            }
        }

        // Dashboard Functions
        async function updateDashboard() {
            const loading = document.getElementById('dashboardLoading');
            loading.classList.add('active');

            try {
                const data = await apiCall('/dashboard');

                document.getElementById('totalVehicles').textContent = data.totalVehicles;
                document.getElementById('totalEarnings').textContent = `â‚¹${data.totalEarnings.toLocaleString('en-IN')}`;
                document.getElementById('totalServices').textContent = data.totalServices;
                document.getElementById('activeEmployees').textContent = data.activeEmployees;

                // Service Stats Table
                const serviceStatsTable = document.getElementById('serviceStatsTable');
                serviceStatsTable.innerHTML = '';
                if (data.serviceStats.length > 0) {
                    data.serviceStats.forEach(stat => {
                        const row = serviceStatsTable.insertRow();
                        row.innerHTML = `
                            <td>${stat.name}</td>
                            <td><span class="badge bg-primary">${stat.count}</span></td>
                            <td>â‚¹${stat.revenue.toLocaleString('en-IN')}</td>
                        `;
                    });
                } else {
                    serviceStatsTable.innerHTML = '<tr><td colspan="3" class="text-center text-muted">No data available</td></tr>';
                }

                // Recent Activities
                const recentActivities = document.getElementById('recentActivities');
                recentActivities.innerHTML = '';
                if (data.recentActivities.length > 0) {
                    const ul = document.createElement('ul');
                    ul.className = 'list-unstyled mb-0';
                    data.recentActivities.forEach(activity => {
                        const li = document.createElement('li');
                        li.className = 'mb-2 text-muted';
                        li.innerHTML = `<i class="fas fa-history me-1"></i> ${activity}`;
                        ul.appendChild(li);
                    });
                    recentActivities.appendChild(ul);
                } else {
                    recentActivities.innerHTML = '<p class="text-muted">No recent activities</p>';
                }

            } catch (error) {
                console.error('Failed to load dashboard:', error);
            } finally {
                loading.classList.remove('active');
            }
        }

        // Service Loading
        async function loadServices() {
            const loading = document.getElementById('servicesLoading');
            loading.classList.add('active');

            try {
                const result = await apiCall('/services', 'GET', null, true); // Silent error for services
                services = result.data;
                const servicesList = document.getElementById('servicesList');
                servicesList.innerHTML = '';

                if (services.length === 0) {
                    servicesList.innerHTML = '<p class="text-muted">No services configured.</p>';
                    return;
                }

                services.forEach(service => {
                    const div = document.createElement('div');
                    div.className = 'service-item d-flex justify-content-between align-items-center';
                    div.innerHTML = `
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="${service.id}" data-name="${service.name}" data-price="${service.price}" id="service-${service.id}">
                            <label class="form-check-label" for="service-${service.id}">
                                ${service.name} <span class="badge badge-custom bg-secondary-subtle text-secondary">${service.type}</span>
                            </label>
                        </div>
                        <span class="fw-bold text-primary">â‚¹${service.price}</span>
                    `;
                    servicesList.appendChild(div);
                });
            } catch (error) {
                console.error('Failed to load services:', error);
                document.getElementById('servicesList').innerHTML = '<p class="text-danger">Failed to load services.</p>';
            } finally {
                loading.classList.remove('active');
            }
        }

        // Employee Loading
        async function loadEmployees() {
            const loading = document.getElementById('employeesLoading');
            loading.classList.add('active');

            try {
                const result = await apiCall('/employees', 'GET', null, true); // Silent error for employees
                employees = result.data;

                // Populate Employee Select in New Bill form
                const employeeSelect = document.getElementById('employeeSelect');
                employeeSelect.innerHTML = '<option value="">Select Employee</option>';
                employees.filter(emp => emp.status === 'Active').forEach(emp => {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = emp.name;
                    employeeSelect.appendChild(option);
                });

                // Populate Employees List in Employee Management page
                const employeesList = document.getElementById('employeesList');
                employeesList.innerHTML = '';
                if (employees.length === 0) {
                    employeesList.innerHTML = '<p class="text-muted">No employees registered.</p>';
                } else {
                    employees.forEach(emp => {
                        const badgeClass = emp.status === 'Active' ? 'bg-success' : 'bg-danger';
                        const card = document.createElement('div');
                        card.className = 'employee-card d-flex justify-content-between align-items-center';
                        card.innerHTML = `
                            <div>
                                <h5 class="mb-1">${emp.name} <span class="badge ${badgeClass} badge-custom">${emp.status}</span></h5>
                                <p class="mb-0 text-muted small">${emp.designation} | Mobile: ${emp.mobile}</p>
                                <p class="mb-0 text-primary small">Salary: â‚¹${emp.salary?.toLocaleString('en-IN') || 'N/A'}</p>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2" onclick="editEmployee(${emp.id})"><i class="fas fa-edit"></i> Edit</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteEmployee(${emp.id})" disabled><i class="fas fa-trash"></i> Delete</button>
                            </div>
                        `;
                        employeesList.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Failed to load employees:', error);
                document.getElementById('employeesList').innerHTML = '<p class="text-danger">Failed to load employee data.</p>';
            } finally {
                loading.classList.remove('active');
            }
        }


        // Vehicle Search (Continuation from prompt)
        async function searchVehicle() {
            const vehicleNum = document.getElementById('vehicleNumber').value.toUpperCase().trim();

            if (!vehicleNum) {
                showNotification('Please enter vehicle number', 'warning');
                return;
            }

            try {
                const result = await apiCall(`/car/${vehicleNum}`);

                if (result.data) {
                    const customer = result.data;
                    currentCustomerId = customer.id;
                    currentVehicleId = customer.vehicle_id || customer.id; // Assuming vehicle_id is present if customer found

                    document.getElementById('customerId').value = customer.id;
                    document.getElementById('vehicleId').value = currentVehicleId;
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('mobileNumber').value = customer.mobile;
                    document.getElementById('vehicleNumberDisplay').value = customer.vehicle_number;
                    document.getElementById('vehicleType').value = customer.vehicle_type;

                    updatePreviewCustomer();
                    showNotification('Customer found! Details auto-filled.', 'success');
                } else {
                    // New customer/vehicle
                    resetCustomerForm();
                    document.getElementById('vehicleNumberDisplay').value = vehicleNum;
                    updatePreviewCustomer();
                    showNotification('New vehicle. Please fill customer details.', 'info');
                }
            } catch (error) {
                resetCustomerForm();
                document.getElementById('vehicleNumberDisplay').value = vehicleNum;
                updatePreviewCustomer();
                showNotification('Failed to search vehicle. Assuming new vehicle.', 'warning');
            }
        }

        function resetCustomerForm() {
            currentCustomerId = null;
            currentVehicleId = null;
            document.getElementById('customerId').value = '';
            document.getElementById('vehicleId').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('mobileNumber').value = '';
            document.getElementById('vehicleNumberDisplay').value = '';
            document.getElementById('vehicleType').value = '';
        }

        // New Bill Functions

        async function getNextBillNumber() {
            try {
                const result = await apiCall('/bill/next_number', 'GET', null, true);
                nextBillNumber = result.data.next_number;
                document.getElementById('billNumber').textContent = `#${nextBillNumber}`;
            } catch (error) {
                console.error('Could not fetch next bill number, defaulting.', error);
                document.getElementById('billNumber').textContent = `#${nextBillNumber}`;
            }
        }

        function updatePreviewCustomer() {
            document.getElementById('previewCustomer').textContent = document.getElementById('customerName').value || '-';
            document.getElementById('previewMobile').textContent = document.getElementById('mobileNumber').value || '-';
            const vehicleNum = document.getElementById('vehicleNumberDisplay').value || '-';
            const vehicleType = document.getElementById('vehicleType').value;
            document.getElementById('previewVehicle').textContent = `${vehicleNum} (${vehicleType || 'Type N/A'})`;
            updatePreview();
        }

        function updatePreview() {
            const selectedServices = [];
            let total = 0;

            // Standard services
            document.querySelectorAll('#servicesList input[type="checkbox"]:checked').forEach(checkbox => {
                const name = checkbox.dataset.name;
                const price = parseFloat(checkbox.dataset.price);
                selectedServices.push({ name, price });
                total += price;
            });

            // Custom services (handled differently as they are not standard checkboxes)
            document.querySelectorAll('#previewServices .custom-service-item').forEach(item => {
                const name = item.dataset.name;
                const price = parseFloat(item.dataset.price);
                selectedServices.push({ name: `${name} (Custom)`, price });
                total += price;
            });

            const previewServicesDiv = document.getElementById('previewServices');
            previewServicesDiv.innerHTML = '';

            if (selectedServices.length === 0) {
                previewServicesDiv.innerHTML = '<p class="text-muted">No services selected</p>';
            } else {
                const ul = document.createElement('ul');
                ul.className = 'list-unstyled small';
                selectedServices.forEach(service => {
                    const li = document.createElement('li');
                    li.className = 'd-flex justify-content-between';
                    li.innerHTML = `<span>${service.name}</span><span class="fw-bold">â‚¹${service.price.toFixed(2)}</span>`;
                    ul.appendChild(li);
                });
                previewServicesDiv.appendChild(ul);
            }

            document.getElementById('totalAmount').textContent = total.toFixed(2);
        }

        function addCustomService() {
            const name = document.getElementById('customServiceName').value.trim();
            const price = parseFloat(document.getElementById('customServicePrice').value);

            if (!name || isNaN(price) || price <= 0) {
                showNotification('Please enter a valid name and price for the custom service.', 'warning');
                return;
            }

            // Create a pseudo-service item for the preview (since it's not a persistent checkbox)
            const previewServicesDiv = document.getElementById('previewServices');

            // Check if 'No services selected' is present and remove it
            if (previewServicesDiv.querySelector('.text-muted') && previewServicesDiv.children.length === 1) {
                 previewServicesDiv.innerHTML = ''; // Clear the initial message
                 const ul = document.createElement('ul');
                 ul.className = 'list-unstyled small';
                 previewServicesDiv.appendChild(ul);
            }

            let ul = previewServicesDiv.querySelector('ul') || document.createElement('ul');
            if (!previewServicesDiv.querySelector('ul')) {
                ul.className = 'list-unstyled small';
                previewServicesDiv.appendChild(ul);
            }

            const li = document.createElement('li');
            li.className = 'd-flex justify-content-between custom-service-item p-1 bg-light rounded mb-1';
            li.dataset.name = name;
            li.dataset.price = price;
            li.innerHTML = `
                <span>${name} (Custom)</span>
                <span class="fw-bold">â‚¹${price.toFixed(2)}
                    <button class="btn btn-sm btn-link text-danger p-0 ms-2" onclick="removeCustomService(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </span>
            `;
            ul.appendChild(li);

            // Clear input fields
            document.getElementById('customServiceName').value = '';
            document.getElementById('customServicePrice').value = '';

            updatePreview();
        }

        function removeCustomService(button) {
            const li = button.closest('.custom-service-item');
            const ul = li.parentNode;
            li.remove();

            // If no services left, restore 'No services selected'
            if (ul.children.length === 0) {
                ul.remove();
                document.getElementById('previewServices').innerHTML = '<p class="text-muted">No services selected</p>';
            }

            updatePreview();
        }


        async function saveBill() {
            const customerName = document.getElementById('customerName').value.trim();
            const mobileNumber = document.getElementById('mobileNumber').value.trim();
            const vehicleNumber = document.getElementById('vehicleNumberDisplay').value.trim();
            const vehicleType = document.getElementById('vehicleType').value;
            const employeeId = document.getElementById('employeeSelect').value;
            const paymentMode = document.getElementById('paymentMode').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').textContent);

            if (!customerName || !mobileNumber || !vehicleNumber || !vehicleType || !employeeId) {
                showNotification('Please fill all customer/vehicle and employee details.', 'danger');
                return;
            }

            const selectedServiceData = [];
            // Standard services
            document.querySelectorAll('#servicesList input[type="checkbox"]:checked').forEach(checkbox => {
                selectedServiceData.push({
                    service_id: parseInt(checkbox.value),
                    name: checkbox.dataset.name,
                    price: parseFloat(checkbox.dataset.price)
                });
            });
            // Custom services
            document.querySelectorAll('#previewServices .custom-service-item').forEach(item => {
                selectedServiceData.push({
                    service_id: 'custom', // Use a special ID for custom services
                    name: item.dataset.name,
                    price: parseFloat(item.dataset.price)
                });
            });


            if (selectedServiceData.length === 0) {
                showNotification('Please select at least one service.', 'danger');
                return;
            }

            const billData = {
                bill_number: nextBillNumber,
                date: new Date().toISOString().split('T')[0],
                customer: {
                    id: currentCustomerId,
                    name: customerName,
                    mobile: mobileNumber
                },
                vehicle: {
                    id: currentVehicleId,
                    number: vehicleNumber,
                    type: vehicleType
                },
                services: selectedServiceData,
                employee_id: parseInt(employeeId),
                payment_mode: paymentMode,
                total_amount: totalAmount
            };

            try {
                await apiCall('/bills', 'POST', billData);
                showNotification(`Bill #${billData.bill_number} saved successfully! Total: â‚¹${totalAmount.toFixed(2)}`, 'success');

                // Print immediately after saving
                printBill();

                resetBillForm();
                getNextBillNumber(); // Prepare for next bill
                updateDashboard();
            } catch (error) {
                console.error('Bill saving failed:', error);
                showNotification('Failed to save bill. Please try again.', 'danger');
            }
        }

        function resetBillForm() {
            document.getElementById('customerForm').reset();
            document.getElementById('vehicleNumber').value = '';
            document.getElementById('customServiceName').value = '';
            document.getElementById('customServicePrice').value = '';
            document.getElementById('paymentMode').value = 'Cash';
            document.getElementById('employeeSelect').value = '';

            document.querySelectorAll('#servicesList input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });

            document.getElementById('previewCustomer').textContent = '-';
            document.getElementById('previewMobile').textContent = '-';
            document.getElementById('previewVehicle').textContent = '-';
            document.getElementById('billDate').textContent = new Date().toLocaleDateString();
            document.getElementById('totalAmount').textContent = '0';

            const previewServicesDiv = document.getElementById('previewServices');
            previewServicesDiv.innerHTML = '<p class="text-muted">No services selected</p>';

            currentCustomerId = null;
            currentVehicleId = null;
        }

        function printBill() {
            window.print();
        }

        // Employee Management Functions

        function editEmployee(empId) {
            const employee = employees.find(e => e.id === empId);
            if (!employee) return;

            document.getElementById('empId').value = employee.id;
            document.getElementById('empName').value = employee.name;
            document.getElementById('empMobile').value = employee.mobile;
            document.getElementById('empDesignation').value = employee.designation;
            document.getElementById('empSalary').value = employee.salary;
            document.getElementById('empJoiningDate').value = employee.joining_date;
            document.getElementById('empStatus').value = employee.status;

            showNotification(`Editing employee: ${employee.name}`, 'info');
        }

        // NOTE: Deletion is disabled in the UI for safety, but the function template is here
        function deleteEmployee(empId) {
            if (confirm('Are you sure you want to delete this employee? (This is simulated)')) {
                showNotification(`Employee ID ${empId} deleted (Simulated)`, 'warning');
                // In a real app, this would be an API call: apiCall(`/employees/${empId}`, 'DELETE')
                loadEmployees();
            }
        }

        async function handleEmployeeFormSubmit(event) {
            event.preventDefault();

            const isEditing = !!document.getElementById('empId').value;
            const empId = document.getElementById('empId').value;

            const employeeData = {
                name: document.getElementById('empName').value.trim(),
                mobile: document.getElementById('empMobile').value.trim(),
                designation: document.getElementById('empDesignation').value.trim(),
                salary: parseFloat(document.getElementById('empSalary').value) || 0,
                joining_date: document.getElementById('empJoiningDate').value,
                status: document.getElementById('empStatus').value
            };

            const endpoint = isEditing ? `/employees/${empId}` : '/employees';
            const method = isEditing ? 'PUT' : 'POST';

            try {
                await apiCall(endpoint, method, employeeData);
                showNotification(`Employee ${isEditing ? 'updated' : 'added'} successfully!`, 'success');
                document.getElementById('employeeForm').reset();
                document.getElementById('empId').value = '';
                loadEmployees();
            } catch (error) {
                console.error('Employee save failed:', error);
                showNotification(`Failed to ${isEditing ? 'update' : 'add'} employee.`, 'danger');
            }
        }

        // Reports Functions

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('toDate').value = today;

            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            document.getElementById('fromDate').value = thirtyDaysAgo.toISOString().split('T')[0];
        }

        async function loadReports() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;

            if (!fromDate || !toDate) {
                showNotification('Please select both From and To dates.', 'warning');
                return;
            }

            const loading = document.getElementById('reportsLoading');
            loading.classList.add('active');

            try {
                // Simulate fetching bills within the date range
                const result = await apiCall('/bills', 'GET', { from: fromDate, to: toDate });
                const bills = result.data;
                const reportsTable = document.getElementById('reportsTable');
                reportsTable.innerHTML = '';

                let totalRevenue = 0;

                if (bills.length === 0) {
                    reportsTable.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No bills found for this date range.</td></tr>';
                } else {
                    bills.forEach(bill => {
                        const row = reportsTable.insertRow();
                        const amount = bill.amount;
                        totalRevenue += amount;

                        row.innerHTML = `
                            <td>#${bill.bill_number}</td>
                            <td>${new Date(bill.date).toLocaleDateString()}</td>
                            <td>${bill.vehicle}</td>
                            <td>${bill.customer}</td>
                            <td><span class="text-truncate d-block" style="max-width: 200px;" title="${bill.services}">${bill.services}</span></td>
                            <td><span class="fw-bold text-success">â‚¹${amount.toLocaleString('en-IN')}</span></td>
                            <td>${bill.employee}</td>
                        `;
                    });
                }

                document.getElementById('reportSummary').textContent = `${bills.length} Bills | Total Revenue: â‚¹${totalRevenue.toLocaleString('en-IN')}`;

            } catch (error) {
                console.error('Failed to load reports:', error);
                document.getElementById('reportsTable').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Failed to load reports.</td></tr>';
                document.getElementById('reportSummary').textContent = 'Error Loading Data';
            } finally {
                loading.classList.remove('active');
            }
        }

    </script>
</body>
</html>